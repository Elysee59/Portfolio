<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ATELIER — Exposition</title>
<meta name="description" content="Exposition photographique · Format original · Entrée libre">
<meta property="og:title" content="Atelier — Exposition Photographique">
<meta property="og:description" content="Portfolio photographique d'auteur. Chaque œuvre dans son format original.">
<meta property="og:type" content="website">
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=EB+Garamond:ital,wght@0,400;0,500;1,400&family=Jost:wght@100;200;300&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#FAFAF8;          /* blanc chaud lumineux */
  --ink:#0A0908;
  --coal:#0E0E0C;
  --dust:#A8A099;
  --rust:#8B6F5E;
  --ease:cubic-bezier(0.76,0,0.24,1);
  --eout:cubic-bezier(0.22,1,0.36,1);
  --mh:64px;
}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--ink);font-family:'Jost',sans-serif;font-weight:200;overflow-x:hidden;cursor:none}

/* ── Grain quasi invisible — juste une micro-texture de papier ── */
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:9000;
  opacity:.12;   /* était .5 → réduit à .12 */
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E")
}
/* Grain WebGL global supprimé — plus d'assombrissement */

/* ── Curseur ── */
#cd{width:4px;height:4px;background:var(--ink);border-radius:50%;position:fixed;top:0;left:0;pointer-events:none;z-index:9999;transform:translate(-50%,-50%);transition:width .2s var(--ease),height .2s,background .2s}
#cr{width:28px;height:28px;border:1px solid rgba(10,9,8,.15);border-radius:50%;position:fixed;top:0;left:0;pointer-events:none;z-index:9998;transform:translate(-50%,-50%);transition:width .35s var(--ease),height .35s,border-color .3s}
body.hov #cd{width:8px;height:8px;background:var(--rust)}
body.hov #cr{width:44px;height:44px;border-color:rgba(139,111,94,.3)}
body.clk #cr{width:18px;height:18px}

/* ── Intro ── */
#intro{position:fixed;inset:0;background:var(--coal);z-index:8500;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;transition:opacity 1.4s var(--ease),visibility 1.4s}
#intro.gone{opacity:0;visibility:hidden;pointer-events:none}
.imark{font-family:'DM Serif Display',serif;font-size:clamp(36px,8vw,86px);color:#FAFAF8;letter-spacing:.38em;text-transform:uppercase;overflow:hidden;line-height:1}
.imark span{display:inline-block;transform:translateY(110%);animation:liftUp 1s var(--eout) forwards}
.imark span:nth-child(1){animation-delay:.00s}.imark span:nth-child(2){animation-delay:.06s}.imark span:nth-child(3){animation-delay:.12s}.imark span:nth-child(4){animation-delay:.18s}.imark span:nth-child(5){animation-delay:.24s}.imark span:nth-child(6){animation-delay:.30s}.imark span:nth-child(7){animation-delay:.36s}
.isub{font-size:9px;letter-spacing:.44em;text-transform:uppercase;color:rgba(250,250,248,.2);opacity:0;animation:fin .6s 1.1s forwards}
@keyframes liftUp{to{transform:translateY(0)}}
@keyframes fin{to{opacity:1}}
@keyframes fdown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

/* ── Nav — fond transparent sur blanc ── */
nav{position:fixed;top:0;left:0;right:0;z-index:500;padding:24px var(--mh);display:flex;align-items:center;justify-content:space-between;pointer-events:none}
.nbrand{font-family:'Jost',sans-serif;font-size:10px;font-weight:300;letter-spacing:.52em;text-transform:uppercase;color:var(--ink);text-decoration:none;pointer-events:all;opacity:0;animation:fdown .7s 1.9s var(--eout) forwards;cursor:none}
.nright{display:flex;align-items:center;gap:36px;pointer-events:all;opacity:0;animation:fdown .7s 2.1s var(--eout) forwards}
.nlink{font-size:8px;letter-spacing:.32em;text-transform:uppercase;color:var(--ink);text-decoration:none;opacity:.3;transition:opacity .3s;cursor:none}
.nlink:hover{opacity:1}
.nlive{display:flex;align-items:center;gap:7px;font-size:8px;letter-spacing:.28em;text-transform:uppercase;color:var(--dust)}
.nlive-dot{width:4px;height:4px;border-radius:50%;background:var(--rust);animation:pulse 2.5s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* ══════════════════════════════════════════
   HERO — plein écran, photo de fond si dispo
   sinon blanc avec grande typo noire
══════════════════════════════════════════ */
.hero{
  height:100vh;min-height:640px;
  background:var(--bg);
  display:flex;flex-direction:column;
  justify-content:flex-end;
  padding:0 var(--mh) 80px;
  position:relative;overflow:hidden;
}
.hero-bg{
  position:absolute;inset:0;
  object-fit:cover;width:100%;height:100%;
  opacity:0;transition:opacity 1.8s var(--ease);
}
.hero-bg.loaded{opacity:1}
/* Overlay léger seulement si photo de fond */
.hero-overlay{position:absolute;inset:0;background:linear-gradient(to top,rgba(10,9,8,.42) 0%,transparent 55%);pointer-events:none;opacity:0;transition:opacity 1.8s}
.hero-overlay.loaded{opacity:1}

.hero-eyebrow{
  font-size:8px;letter-spacing:.48em;text-transform:uppercase;
  color:var(--dust);margin-bottom:16px;
  overflow:hidden;position:relative;z-index:2;
}
.hero-eyebrow span{display:block;transform:translateY(100%);animation:liftUp .8s 1.4s var(--eout) forwards}
.hero-h1{
  font-family:'DM Serif Display',serif;
  font-size:clamp(52px,9vw,120px);
  line-height:.90;color:var(--ink);
  position:relative;z-index:2;
}
.hero-h1.light{color:#FAFAF8} /* si photo de fond */
.hline{display:block;overflow:hidden}
.hline span{display:block;transform:translateY(110%);animation:liftUp 1.1s var(--eout) forwards}
.hline:nth-child(1) span{animation-delay:1.0s}
.hline:nth-child(2) span{animation-delay:1.15s;font-style:italic}
.hline:nth-child(3) span{animation-delay:1.3s}
.hero-caption{
  font-family:'EB Garamond',serif;font-size:16px;font-style:italic;
  color:rgba(10,9,8,.4);letter-spacing:.02em;
  margin-top:22px;position:relative;z-index:2;overflow:hidden;
}
.hero-caption.light{color:rgba(250,250,248,.45)}
.hero-caption span{display:block;transform:translateY(100%);animation:liftUp .8s 1.6s var(--eout) forwards}
.hero-scroll{
  position:absolute;bottom:80px;right:var(--mh);
  display:flex;flex-direction:column;align-items:center;gap:10px;
  opacity:0;animation:fin 1s 2.5s forwards;z-index:2;
}
.scbar{width:1px;height:48px;background:rgba(10,9,8,.15);position:relative;overflow:hidden}
.scbar::after{content:'';position:absolute;inset:0;background:var(--ink);transform:translateY(-100%);animation:scpulse 2.2s 3s infinite var(--ease)}
@keyframes scpulse{0%{transform:translateY(-100%)}50%{transform:translateY(0)}100%{transform:translateY(100%)}}
.sclabel{font-size:7px;letter-spacing:.4em;text-transform:uppercase;color:rgba(10,9,8,.25);writing-mode:vertical-rl}

/* ── Marquee ── */
.mband{padding:14px 0;overflow:hidden;border-top:1px solid rgba(10,9,8,.06);border-bottom:1px solid rgba(10,9,8,.06)}
.mtrack{display:flex;width:max-content;animation:roll 30s linear infinite}
.mtrack:hover{animation-play-state:paused}
@keyframes roll{to{transform:translateX(-50%)}}
.mi{display:flex;align-items:center;gap:44px;padding:0 44px;flex-shrink:0}
.mi>span{font-size:9px;letter-spacing:.36em;text-transform:uppercase;color:rgba(10,9,8,.22);white-space:nowrap}
.mi>span em{font-style:italic;color:rgba(10,9,8,.12)}
.mdot{width:2px;height:2px;border-radius:50%;background:var(--rust);opacity:.4;flex-shrink:0}

/* ══════════════════════════════════════════
   MUR ÉDITORIAL — photos grandes et aérées
   Fond blanc, ombres légères, pas de passe-partout
══════════════════════════════════════════ */
#wall{padding:80px 0 200px;background:var(--bg)}

.eblock{
  position:relative;width:100%;
  opacity:0;transform:translateY(36px);
  transition:opacity 1.1s var(--ease),transform 1.1s var(--ease);
}
.eblock.vis{opacity:1;transform:translateY(0)}

.piece{position:absolute;cursor:none;z-index:1}
.piece:hover{z-index:10}

/* Cadre : fond blanc pur, ombre très légère */
.pframe{
  background:#fff;
  /* Ombre subtile — pas d'ombre lourde qui assombrit */
  box-shadow:0 2px 8px rgba(10,9,8,.06),0 8px 24px rgba(10,9,8,.08),0 20px 48px rgba(10,9,8,.06);
  transition:transform .9s var(--ease),box-shadow .9s var(--ease);
  transform-origin:bottom center;
  position:relative;overflow:hidden;
}
.piece:hover .pframe{
  transform:translateY(-6px) scale(1.006);
  box-shadow:0 4px 14px rgba(10,9,8,.08),0 16px 40px rgba(10,9,8,.11),0 36px 72px rgba(10,9,8,.09);
}

/* Image sans passe-partout — pleine largeur du cadre */
.pimg{
  display:block;
  width:100%;height:100%;
  object-fit:cover;   /* couvre tout le cadre */
  position:relative;z-index:1;
}

/* Grain au hover — très subtil sur fond clair */
.piece-gl{position:absolute;inset:0;pointer-events:none;z-index:2;opacity:0;transition:opacity .5s var(--ease)}
.piece:hover .piece-gl{opacity:.6} /* réduit de 1 → .6 */

/* Label sous la photo */
.plabel{
  display:flex;justify-content:space-between;align-items:baseline;
  gap:10px;padding-top:9px;padding-left:1px;padding-right:1px;
}
.ptitle{font-family:'EB Garamond',serif;font-size:11px;font-style:italic;color:rgba(10,9,8,.35);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:180px}
.pnum{font-size:7px;letter-spacing:.28em;text-transform:uppercase;color:var(--dust);white-space:nowrap;flex-shrink:0}

/* Bouton expand */
.pexp{
  position:absolute;top:10px;right:10px;
  width:30px;height:30px;
  background:rgba(250,250,248,.85);backdrop-filter:blur(8px);
  border:1px solid rgba(10,9,8,.08);border-radius:2px;
  cursor:none;display:flex;align-items:center;justify-content:center;
  opacity:0;transform:translateY(-4px);
  transition:opacity .3s var(--ease),transform .3s,background .2s;z-index:3;
}
.piece:hover .pexp{opacity:1;transform:translateY(0)}
.pexp:hover{background:rgba(10,9,8,.9)}
.pexp:hover svg{stroke:rgba(250,250,248,.9)}
.pexp svg{width:10px;height:10px;stroke:rgba(10,9,8,.55);fill:none;stroke-width:1.5;transition:stroke .2s}

/* ── Spacer éditorial ── */
.spacer{
  padding:100px var(--mh) 0;
  display:grid;grid-template-columns:1fr auto 1fr;
  align-items:center;gap:28px;
  opacity:0;transform:translateY(24px);
  transition:opacity .9s var(--ease),transform .9s var(--ease);
}
.spacer.vis{opacity:1;transform:translateY(0)}
.sline{height:1px;background:rgba(10,9,8,.07)}
.stxt{
  font-family:'DM Serif Display',serif;
  font-size:clamp(18px,2vw,28px);
  font-style:italic;color:rgba(10,9,8,.35);
  white-space:nowrap;text-align:center;
}

/* ── Section header ── */
.sec-head{
  padding:0 var(--mh) 56px;
  display:flex;align-items:flex-end;justify-content:space-between;
  border-bottom:1px solid rgba(10,9,8,.06);
}
.sec-head h2{font-family:'DM Serif Display',serif;font-size:clamp(34px,4.5vw,62px);font-style:italic;color:var(--ink);line-height:.95}
.sec-head h2 span{font-style:normal;display:block}
.sec-right{text-align:right;padding-bottom:4px}
.cnt-big{font-family:'EB Garamond',serif;font-size:48px;color:rgba(10,9,8,.08);line-height:1}
.cnt-label{font-size:8px;letter-spacing:.36em;text-transform:uppercase;color:var(--dust)}

/* ── État vide ── */
.expo-vide{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:50vh;gap:16px;text-align:center;padding:80px}
.ev-icon{font-family:'DM Serif Display',serif;font-size:48px;font-style:italic;color:var(--dust);opacity:.2}
.ev-title{font-family:'DM Serif Display',serif;font-size:18px;font-style:italic;color:var(--dust)}
.ev-sub{font-size:8px;letter-spacing:.3em;text-transform:uppercase;color:var(--dust);opacity:.4}

/* ── Lightbox — fond très sombre ── */
#lb{position:fixed;inset:0;z-index:7000;background:rgba(8,8,6,0);display:flex;align-items:center;justify-content:center;pointer-events:none;transition:background .5s var(--ease)}
#lb.open{background:rgba(8,8,6,.97);pointer-events:all}
.lbw{position:relative;max-width:90vw;max-height:88vh;opacity:0;transform:scale(.96) translateY(8px);transition:opacity .5s var(--ease),transform .5s var(--ease)}
#lb.open .lbw{opacity:1;transform:scale(1) translateY(0)}
#lbimg{max-width:88vw;max-height:85vh;width:auto;height:auto;object-fit:contain;display:block;box-shadow:0 60px 120px rgba(0,0,0,.5)}
.lbmeta{position:absolute;bottom:-36px;left:0;right:0;display:flex;justify-content:space-between}
.lbtitle{font-family:'EB Garamond',serif;font-style:italic;font-size:13px;color:rgba(250,250,248,.28)}
.lbctr{font-size:8px;letter-spacing:.3em;text-transform:uppercase;color:rgba(250,250,248,.18)}
#lbclose{position:fixed;top:28px;right:44px;background:none;border:none;cursor:none;display:flex;align-items:center;gap:10px;font-family:'Jost',sans-serif;font-size:8px;letter-spacing:.3em;text-transform:uppercase;color:rgba(250,250,248,.3);transition:color .3s}
#lbclose:hover{color:rgba(250,250,248,.8)}
.lbx{width:16px;height:16px;position:relative}
.lbx::before,.lbx::after{content:'';position:absolute;top:50%;left:0;right:0;height:1px;background:currentColor}
.lbx::before{transform:translateY(-50%) rotate(45deg)}
.lbx::after{transform:translateY(-50%) rotate(-45deg)}
.lbnav{position:fixed;top:50%;transform:translateY(-50%);width:44px;height:44px;background:none;border:1px solid rgba(250,250,248,.1);display:flex;align-items:center;justify-content:center;cursor:none;transition:border-color .3s}
.lbnav:hover{border-color:rgba(250,250,248,.35)}
.lbnav.lp{left:32px}.lbnav.ln{right:32px}
.lbnav svg{width:14px;height:14px;stroke:rgba(250,250,248,.4);fill:none;stroke-width:1.2;transition:stroke .2s}
.lbnav:hover svg{stroke:rgba(250,250,248,.85)}
.lbdims{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);font-size:8px;letter-spacing:.28em;text-transform:uppercase;color:rgba(250,250,248,.14)}

/* ── Footer — blanc, sobre ── */
footer{background:var(--bg);padding:80px var(--mh) 48px;border-top:1px solid rgba(10,9,8,.07)}
.fgrid{display:grid;grid-template-columns:2fr 1fr;gap:60px;padding-bottom:52px;border-bottom:1px solid rgba(10,9,8,.07)}
.fbrand{font-family:'DM Serif Display',serif;font-size:32px;font-style:italic;color:var(--ink);line-height:1.1}
.fbrand small{display:block;font-family:'Jost',sans-serif;font-size:8px;font-style:normal;letter-spacing:.36em;text-transform:uppercase;color:rgba(10,9,8,.22);margin-top:10px}
.fcol h4{font-size:8px;letter-spacing:.36em;text-transform:uppercase;color:rgba(10,9,8,.22);margin-bottom:16px}
.fcol ul{list-style:none;display:flex;flex-direction:column;gap:10px}
.fcol a{font-family:'EB Garamond',serif;font-size:15px;color:rgba(10,9,8,.3);text-decoration:none;transition:color .3s;cursor:none}
.fcol a:hover{color:var(--ink)}
.fbot{display:flex;justify-content:space-between;align-items:center;padding-top:32px;flex-wrap:wrap;gap:10px}
.fcopy{font-size:8px;letter-spacing:.26em;text-transform:uppercase;color:rgba(10,9,8,.16)}

.rv{opacity:0;transform:translateY(28px);transition:opacity .9s var(--ease),transform .9s var(--ease)}
.rv.vis{opacity:1;transform:translateY(0)}
.rv.d1{transition-delay:.1s}.rv.d2{transition-delay:.22s}

/* ── Responsive ── */
@media(max-width:760px){
  :root{--mh:20px}
  .fgrid{grid-template-columns:1fr}
  .eblock{height:auto!important}
  .piece{position:relative!important;left:auto!important;top:auto!important;width:auto!important;margin-bottom:24px}
  .pframe{width:100%!important}
  .pimg{width:100%!important;height:auto!important;object-fit:contain}
  .hero-h1{font-size:clamp(40px,12vw,80px)}
}
</style>
</head>
<body>

<div id="intro">
  <div class="imark"><span>A</span><span>T</span><span>E</span><span>L</span><span>I</span><span>E</span><span>R</span></div>
  <div class="isub">Exposition Photographique</div>
</div>

<div id="cd"></div><div id="cr"></div>

<nav>
  <a href="/" class="nbrand">Atelier</a>
  <div class="nright">
    <a href="#expo" class="nlink">Exposition</a>
    <a href="#" class="nlink">Contact</a>
    <div class="nlive"><div class="nlive-dot"></div><span id="nav-count">—</span></div>
  </div>
</nav>

<!-- Hero : fond blanc avec grande typo noire. Si photos disponibles,
     la première photo s'affiche en arrière-plan via JS -->
<section class="hero" id="hero">
  <img class="hero-bg" id="hero-bg" src="" alt="" crossorigin="anonymous">
  <div class="hero-overlay" id="hero-overlay"></div>
  <div class="hero-eyebrow"><span>Collection · 2024</span></div>
  <h1 class="hero-h1" id="hero-h1">
    <span class="hline"><span>La lumière</span></span>
    <span class="hline"><span>révèle</span></span>
    <span class="hline"><span>l'essentiel.</span></span>
  </h1>
  <p class="hero-caption" id="hero-caption"><span>Photographie d'auteur · Format original · Entrée libre</span></p>
  <div class="hero-scroll"><div class="scbar"></div><span class="sclabel">Défiler</span></div>
</section>

<div class="mband">
  <div class="mtrack">
    <div class="mi"><span>Format original</span><div class="mdot"></div><span><em>Jamais rogné</em></span><div class="mdot"></div><span>Portrait · Paysage · Carré</span><div class="mdot"></div><span><em>2024</em></span><div class="mdot"></div></div>
    <div class="mi"><span>Format original</span><div class="mdot"></div><span><em>Jamais rogné</em></span><div class="mdot"></div><span>Portrait · Paysage · Carré</span><div class="mdot"></div><span><em>2024</em></span><div class="mdot"></div></div>
    <div class="mi"><span>Format original</span><div class="mdot"></div><span><em>Jamais rogné</em></span><div class="mdot"></div><span>Portrait · Paysage · Carré</span><div class="mdot"></div><span><em>2024</em></span><div class="mdot"></div></div>
    <div class="mi"><span>Format original</span><div class="mdot"></div><span><em>Jamais rogné</em></span><div class="mdot"></div><span>Portrait · Paysage · Carré</span><div class="mdot"></div><span><em>2024</em></span><div class="mdot"></div></div>
  </div>
</div>

<section id="expo">
  <div style="padding:80px var(--mh) 56px">
    <div class="sec-head rv">
      <div><h2><span>Salle</span><em>d'exposition</em></h2></div>
      <div class="sec-right">
        <div class="cnt-big" id="cnt">—</div>
        <div class="cnt-label">œuvres</div>
      </div>
    </div>
  </div>
  <div id="wall"></div>
</section>

<footer>
  <div class="fgrid">
    <div class="rv"><div class="fbrand">Atelier<br>Photo<small>Exposition · Format original</small></div></div>
    <div class="fcol rv d1"><h4>Navigation</h4><ul><li><a href="/">Accueil</a></li><li><a href="#expo">Exposition</a></li><li><a href="#">Contact</a></li></ul></div>
  </div>
  <div class="fbot">
    <span class="fcopy">© 2024 Atelier — Tous droits réservés</span>
    <span class="fcopy">Portfolio photographique · Format original</span>
  </div>
</footer>

<!-- Lightbox -->
<div id="lb">
  <button id="lbclose"><div class="lbx"></div><span>Fermer</span></button>
  <div class="lbw">
    <img id="lbimg" src="" alt="" crossorigin="anonymous">
    <div class="lbmeta"><span class="lbtitle" id="lbtitle"></span><span class="lbctr" id="lbctr"></span></div>
  </div>
  <button class="lbnav lp" id="lbprev"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg></button>
  <button class="lbnav ln" id="lbnext"><svg viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg></button>
  <div class="lbdims" id="lbdims"></div>
</div>

<script>
'use strict';

/* ══════════════════════════════════════════
   GRAIN PER-IMAGE AU HOVER (conservé, réduit)
   Effet argentique subtil uniquement au survol
══════════════════════════════════════════ */
const IVS=`attribute vec2 a_pos;attribute vec2 a_uv;varying vec2 v_uv;void main(){v_uv=a_uv;gl_Position=vec4(a_pos,0,1);}`;
const IFS=`precision mediump float;uniform sampler2D u_tex;uniform float u_time;uniform float u_hover;varying vec2 v_uv;float hash(vec2 p){return fract(sin(dot(p,vec2(127.1,311.7)))*43758.5453);}void main(){vec2 uv=v_uv;vec4 s=texture2D(u_tex,clamp(uv,0.,1.));vec3 col=s.rgb;float t=floor(u_time*24.)/24.;float g=(hash(uv*820.+t*73.)-.5)*.05*u_hover;col=col+vec3(g);gl_FragColor=vec4(col,s.a);}`;
const glCtxs=new Map();

function createGL(piece,img){
  const cv=document.createElement('canvas');
  cv.width=img.naturalWidth||img.width;cv.height=img.naturalHeight||img.height;
  cv.style.cssText='position:absolute;inset:0;width:100%;height:100%;pointer-events:none;z-index:2;opacity:0;transition:opacity .5s';
  piece.querySelector('.pframe').appendChild(cv);
  const gl=cv.getContext('webgl',{alpha:true,premultipliedAlpha:false});if(!gl)return;
  const mk=(s,t)=>{const x=gl.createShader(t);gl.shaderSource(x,s);gl.compileShader(x);return x;};
  const prog=gl.createProgram();gl.attachShader(prog,mk(IVS,gl.VERTEX_SHADER));gl.attachShader(prog,mk(IFS,gl.FRAGMENT_SHADER));gl.linkProgram(prog);gl.useProgram(prog);
  const verts=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,-1,1,0,0,1,-1,1,1,1,1,1,0]);
  const buf=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,buf);gl.bufferData(gl.ARRAY_BUFFER,verts,gl.STATIC_DRAW);
  const ap=gl.getAttribLocation(prog,'a_pos'),au=gl.getAttribLocation(prog,'a_uv');
  gl.enableVertexAttribArray(ap);gl.vertexAttribPointer(ap,2,gl.FLOAT,false,16,0);
  gl.enableVertexAttribArray(au);gl.vertexAttribPointer(au,2,gl.FLOAT,false,16,8);
  const tex=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,tex);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);
  gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);
  try{gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,img);}catch(e){cv.remove();return;}
  const uT=gl.getUniformLocation(prog,'u_time'),uH=gl.getUniformLocation(prog,'u_hover');
  gl.uniform1i(gl.getUniformLocation(prog,'u_tex'),0);
  const ctx={gl,cv,uT,uH,hover:0,active:false,raf:null};glCtxs.set(piece,ctx);
  piece.addEventListener('mouseenter',()=>{ctx.active=true;cv.style.opacity='.6';if(!ctx.raf)animGL(ctx);});
  piece.addEventListener('mouseleave',()=>{ctx.active=false;const f=()=>{ctx.hover=Math.max(0,ctx.hover-.06);drawGL(ctx,performance.now()/1000);if(ctx.hover>0)requestAnimationFrame(f);else{cv.style.opacity='0';ctx.raf=null;}};requestAnimationFrame(f);});
}
function animGL(c){if(!c.active&&c.hover<=0){c.raf=null;return;}c.hover=Math.min(1,c.hover+.04);drawGL(c,performance.now()/1000);c.raf=requestAnimationFrame(()=>animGL(c));}
function drawGL(c,t){const{gl,cv,uT,uH}=c;gl.viewport(0,0,cv.width,cv.height);gl.uniform1f(uT,t);gl.uniform1f(uH,c.hover);gl.drawArrays(gl.TRIANGLES,0,6);}

/* ── Curseur ── */
const CD=document.getElementById('cd'),CR=document.getElementById('cr');
let mx=0,my=0,rx=0,ry=0;
document.addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY;});
(function aC(){CD.style.left=mx+'px';CD.style.top=my+'px';rx+=(mx-rx)*.11;ry+=(my-ry)*.11;CR.style.left=rx+'px';CR.style.top=ry+'px';requestAnimationFrame(aC);})();
document.addEventListener('mousedown',()=>document.body.classList.add('clk'));
document.addEventListener('mouseup',()=>document.body.classList.remove('clk'));
function addH(els){els.forEach(el=>{el.addEventListener('mouseenter',()=>document.body.classList.add('hov'));el.addEventListener('mouseleave',()=>document.body.classList.remove('hov'));});}
addH(document.querySelectorAll('a,button'));

/* ── Reveal ── */
const io=new IntersectionObserver(e=>{e.forEach(x=>{if(x.isIntersecting){x.target.classList.add('vis');io.unobserve(x.target);}});},{threshold:.04,rootMargin:'0px 0px -30px 0px'});
document.querySelectorAll('.rv').forEach(el=>io.observe(el));

/* ── Parallaxe légère ── */
const pxArr=[];function regPx(el,s){pxArr.push({el,s});}
let tick=false;
window.addEventListener('scroll',()=>{if(!tick){requestAnimationFrame(()=>{pxArr.forEach(({el,s})=>{const c=el.getBoundingClientRect(),d=(window.innerHeight/2-(c.top+c.height/2))*s*.03;const f=el.querySelector('.pframe');if(f&&!el.closest('.eblock')?.classList.contains('drag'))f.style.transform=`translateY(${d.toFixed(2)}px)`;});tick=false;});tick=true;}},{passive:true});

/* ══════════════════════════════════════════
   SÉQUENCES — photos plus grandes
   w augmenté, H augmenté pour remplir l'écran
══════════════════════════════════════════ */
const SQ={
  /* Solo paysage — très grand */
  SOLO_LAND_FULL: {n:1,H:.82,slots:[{x:.03,y:.04,w:.94,z:1,f:0,vO:0}]},
  SOLO_LAND_L:    {n:1,H:.72,slots:[{x:.03,y:.06,w:.60,z:1,f:0,vO:0}]},
  SOLO_LAND_R:    {n:1,H:.72,slots:[{x:.37,y:.06,w:.60,z:1,f:0,vO:0}]},
  /* Solo portrait — large et centré */
  SOLO_PORT_C:    {n:1,H:.96,slots:[{x:.28,y:.03,w:.44,z:1,f:0,vO:0}]},
  SOLO_PORT_L:    {n:1,H:.94,slots:[{x:.06,y:.03,w:.42,z:1,f:0,vO:0}]},
  SOLO_PORT_R:    {n:1,H:.94,slots:[{x:.52,y:.03,w:.42,z:1,f:0,vO:0}]},
  SOLO_SQ:        {n:1,H:.78,slots:[{x:.20,y:.05,w:.60,z:1,f:0,vO:0}]},
  /* Duo portraits — pleine hauteur */
  DUO_PORT_OPEN:  {n:2,H:.98,slots:[{x:.03,y:.01,w:.46,z:2,f:0,vO:-20},{x:.51,y:.05,w:.46,z:1,f:0,vO:20}]},
  DUO_PORT_TIGHT: {n:2,H:.92,slots:[{x:.06,y:.04,w:.40,z:1,f:0,vO:0},{x:.54,y:.01,w:.40,z:2,f:0,vO:-16}]},
  /* Duo paysage */
  DUO_LAND:       {n:2,H:.76,slots:[{x:.02,y:.04,w:.56,z:1,f:0,vO:-12},{x:.44,y:.14,w:.54,z:2,f:0,vO:16}]},
  /* Duo mixte */
  DUO_MIX_A:     {n:2,H:.90,slots:[{x:.03,y:.04,w:.58,z:1,f:0,vO:8},{x:.58,y:.03,w:.36,z:2,f:0,vO:-22}]},
  DUO_MIX_B:     {n:2,H:.90,slots:[{x:.06,y:.03,w:.36,z:2,f:0,vO:-22},{x:.40,y:.06,w:.58,z:1,f:0,vO:12}]},
  /* Trio */
  TRIO_SPREAD:    {n:3,H:.98,slots:[{x:.02,y:.01,w:.30,z:2,f:0,vO:-30},{x:.35,y:.08,w:.30,z:1,f:0,vO:22},{x:.68,y:.00,w:.29,z:3,f:0,vO:-10}]},
  TRIO_MIX_LEAD:  {n:3,H:.96,slots:[{x:.02,y:.04,w:.52,z:1,f:0,vO:0},{x:.57,y:.01,w:.28,z:3,f:0,vO:-24},{x:.57,y:.44,w:.28,z:2,f:0,vO:18}]},
  TRIO_OVERLAP:   {n:3,H:.94,slots:[{x:.01,y:.04,w:.44,z:1,f:0,vO:0},{x:.32,y:.02,w:.40,z:2,f:0,vO:-18},{x:.62,y:.10,w:.36,z:3,f:0,vO:16}]},
  /* Quad */
  QUAD_ROW:       {n:4,H:.98,slots:[{x:.01,y:.01,w:.23,z:2,f:0,vO:-28},{x:.26,y:.08,w:.24,z:4,f:0,vO:18},{x:.51,y:.00,w:.23,z:1,f:0,vO:32},{x:.76,y:.06,w:.23,z:3,f:0,vO:-14}]},
  QUAD_BIG_SMALL: {n:4,H:1.04,slots:[{x:.02,y:.00,w:.52,z:1,f:0,vO:0},{x:.56,y:.02,w:.42,z:2,f:0,vO:20},{x:.04,y:.52,w:.26,z:3,f:0,vO:-14},{x:.68,y:.56,w:.28,z:4,f:0,vO:12}]},
};

let lastSQ='';
function pickSQ(g){
  const n=g.length,o=g.map(p=>p.orient);
  const ports=o.filter(x=>x==='port').length,lands=o.filter(x=>x==='land').length;
  let c=[];
  if(n===1){
    const or=o[0];
    if(or==='land')c=['SOLO_LAND_FULL','SOLO_LAND_L','SOLO_LAND_R'];
    else if(or==='port')c=['SOLO_PORT_C','SOLO_PORT_L','SOLO_PORT_R'];
    else c=['SOLO_SQ'];
  }else if(n===2){
    if(ports===2)c=['DUO_PORT_OPEN','DUO_PORT_TIGHT'];
    else if(lands===2)c=['DUO_LAND'];
    else c=['DUO_MIX_A','DUO_MIX_B'];
  }else if(n===3){
    c=['TRIO_SPREAD','TRIO_MIX_LEAD','TRIO_OVERLAP'];
  }else{
    c=['QUAD_ROW','QUAD_BIG_SMALL'];
  }
  const f=c.filter(k=>k!==lastSQ);
  const pool=f.length?f:c;
  const k=pool[Math.floor(Math.random()*pool.length)];
  lastSQ=k;return SQ[k];
}

function groupPhotos(list){
  const groups=[],sizes=[1,2,3,2,1,3,1,2,4,1,2,3];
  let i=0,si=0;
  while(i<list.length){
    const d=Math.min(sizes[si%sizes.length],list.length-i);
    // Photo très large seule
    if(d>1&&list[i].ratio>1.8){groups.push([list[i]]);i++;si++;}
    else{groups.push(list.slice(i,i+d));i+=d;si++;}
  }
  return groups;
}

let photos=[],lbIdx=0;

function buildBlock(group,startIdx,seqNum){
  const seq=pickSQ(group);
  const VH=window.innerHeight;
  const mh=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--mh'))||64;
  const availW=window.innerWidth-mh*2;
  const blockH=Math.round(VH*seq.H);
  const margins=[0,-16,12,-8,20,-4,16,-12,0,10];
  const block=document.createElement('div');
  block.className='eblock';
  block.style.cssText=`height:${blockH}px;margin-top:${margins[seqNum%margins.length]}px`;

  group.forEach((photo,i)=>{
    if(i>=seq.slots.length)return;
    const slot=seq.slots[i];
    const slotW=Math.round(availW*slot.w);
    const fp2=slot.f*2; // padding=0 donc fp2=0

    let imgW=slotW-fp2;
    let imgH=Math.round(imgW/photo.ratio);
    const maxH=Math.round(blockH*.90)-fp2;
    if(imgH>maxH){imgH=maxH;imgW=Math.round(imgH*photo.ratio);}
    imgW=Math.max(imgW,80);imgH=Math.max(imgH,80);

    const px=Math.round(mh+availW*slot.x);
    const py=Math.round(blockH*slot.y+(slot.vO||0));

    const piece=document.createElement('div');
    piece.className='piece';
    piece.style.cssText=`left:${px}px;top:${py}px;width:${imgW+fp2}px;z-index:${slot.z}`;

    const frame=document.createElement('div');
    frame.className='pframe';
    if(slot.f>0)frame.style.padding=`${slot.f}px`;

    const imgEl=document.createElement('img');
    imgEl.className='pimg';
    imgEl.crossOrigin='anonymous';
    imgEl.src=photo.url;
    imgEl.alt=photo.name;
    imgEl.style.cssText=`width:${imgW}px;height:${imgH}px`;
    imgEl.loading='lazy';

    const btn=document.createElement('button');
    btn.className='pexp';
    btn.innerHTML=`<svg viewBox="0 0 24 24"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>`;

    frame.appendChild(imgEl);frame.appendChild(btn);piece.appendChild(frame);

    const lbl=document.createElement('div');
    lbl.className='plabel';
    lbl.innerHTML=`<span class="ptitle">${photo.name}</span><span class="pnum">${String(startIdx+i+1).padStart(2,'0')}</span>`;
    piece.appendChild(lbl);

    const idx=startIdx+i;
    btn.addEventListener('click',e=>{e.stopPropagation();openLb(idx);});
    piece.addEventListener('click',()=>openLb(idx));

    if(imgEl.complete&&imgEl.naturalWidth>0)createGL(piece,imgEl);
    else imgEl.addEventListener('load',()=>createGL(piece,imgEl),{once:true});

    if(i>0)regPx(piece,[0,.025,-.03,.04,-.015][i%5]);
    block.appendChild(piece);
  });
  return block;
}

const SPACERS=['L\'Esprit de la Forme','Lumière & Matière','L\'œil qui choisit','Fragments d\'éternité','Le cadre révèle','Instants suspendus'];
function buildSpacer(i){
  const el=document.createElement('div');
  el.className='spacer';
  el.innerHTML=`<div class="sline"></div><div class="stxt">${SPACERS[i%SPACERS.length]}</div><div class="sline"></div>`;
  io.observe(el);return el;
}

function renderWall(){
  const wall=document.getElementById('wall');
  pxArr.length=0;glCtxs.clear();
  document.getElementById('cnt').textContent=String(photos.length).padStart(2,'0');
  document.getElementById('nav-count').textContent=photos.length+' œuvres';

  if(!photos.length){
    wall.innerHTML=`<div class="expo-vide"><div class="ev-icon">∅</div><div class="ev-title">Exposition en préparation</div><div class="ev-sub">Les œuvres arrivent bientôt</div></div>`;
    return;
  }

  wall.innerHTML='';
  const groups=groupPhotos(photos);let gIdx=0;
  groups.forEach((g,s)=>{
    if(s>0&&s%2===1)wall.appendChild(buildSpacer(s));
    const b=buildBlock(g,gIdx,s);
    wall.appendChild(b);io.observe(b);
    gIdx+=g.length;
  });
  addH(wall.querySelectorAll('.piece,.pexp'));
}

/* ── Hero dynamique ── */
function setHeroBg(url){
  const bg=document.getElementById('hero-bg');
  const ov=document.getElementById('hero-overlay');
  const h1=document.getElementById('hero-h1');
  const cap=document.getElementById('hero-caption');
  bg.onload=()=>{bg.classList.add('loaded');ov.classList.add('loaded');h1.classList.add('light');cap.classList.add('light');};
  bg.src=url;
}

/* ── Lightbox ── */
const LB=document.getElementById('lb'),LBIMG=document.getElementById('lbimg');
const LBTIT=document.getElementById('lbtitle'),LBCTR=document.getElementById('lbctr'),LBDMS=document.getElementById('lbdims');
function openLb(i){lbIdx=i;const p=photos[i];LBIMG.src=p.url;LBTIT.textContent=p.name;LBCTR.textContent=`${i+1} / ${photos.length}`;LBDMS.textContent=`${p.w} × ${p.h} px`;LB.classList.add('open');document.body.style.overflow='hidden';}
function closeLb(){LB.classList.remove('open');document.body.style.overflow='';setTimeout(()=>{LBIMG.src='';},500);}
function navLb(d){lbIdx=(lbIdx+d+photos.length)%photos.length;LBIMG.style.cssText='opacity:0;transform:scale(.96)';setTimeout(()=>{const p=photos[lbIdx];LBIMG.src=p.url;LBTIT.textContent=p.name;LBCTR.textContent=`${lbIdx+1} / ${photos.length}`;LBDMS.textContent=`${p.w} × ${p.h} px`;LBIMG.style.cssText='opacity:1;transform:scale(1)';},200);}
LBIMG.style.transition='opacity .2s,transform .2s';
document.getElementById('lbclose').addEventListener('click',closeLb);
document.getElementById('lbprev').addEventListener('click',()=>navLb(-1));
document.getElementById('lbnext').addEventListener('click',()=>navLb(1));
LB.addEventListener('click',e=>{if(e.target===LB)closeLb();});
document.addEventListener('keydown',e=>{if(!LB.classList.contains('open'))return;if(e.key==='Escape')closeLb();if(e.key==='ArrowLeft')navLb(-1);if(e.key==='ArrowRight')navLb(1);});
addH(document.querySelectorAll('#lbclose,#lbprev,#lbnext'));
let rt;window.addEventListener('resize',()=>{clearTimeout(rt);rt=setTimeout(()=>{if(photos.length>0)renderWall();},280);});

/* ── Init ── */
async function init(){
  try{
    const r=await fetch('/api/photos');
    if(r.ok)photos=(await r.json()).sort((a,b)=>a.order-b.order);
  }catch(e){photos=[];}

  // Hero : utiliser la première photo paysage si disponible
  const heroPhoto=photos.find(p=>p.orient==='land')||photos[0];
  if(heroPhoto)setHeroBg(heroPhoto.url);

  setTimeout(()=>document.getElementById('intro').classList.add('gone'),photos.length>0?2100:600);
  renderWall();
}
init();
</script>
</body>
</html>
